<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Dockerfile中的RUN、CMD、ENTRYPOINT比较 | Hzml Code-Book</title>
    <meta name="generator" content="VuePress 1.8.2">
    <script src="https://www.googletagmanager.com/gtag/js?id=G-175K59GC1N" async="true"></script>
    <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            
            gtag('config', 'G-175K59GC1N');
        </script>
    <meta name="description" content="Hzml Code-Book">
    
    <link rel="preload" href="/docs/assets/css/0.styles.eb47bffd.css" as="style"><link rel="preload" href="/docs/assets/js/app.01c93764.js" as="script"><link rel="preload" href="/docs/assets/js/2.2d8514e9.js" as="script"><link rel="preload" href="/docs/assets/js/25.ae0fe913.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.c7c6a8e3.js"><link rel="prefetch" href="/docs/assets/js/11.c9661a93.js"><link rel="prefetch" href="/docs/assets/js/12.1279196e.js"><link rel="prefetch" href="/docs/assets/js/13.11f069e8.js"><link rel="prefetch" href="/docs/assets/js/14.0d56bfa0.js"><link rel="prefetch" href="/docs/assets/js/15.9c25e017.js"><link rel="prefetch" href="/docs/assets/js/16.b63ae8c6.js"><link rel="prefetch" href="/docs/assets/js/17.3317484b.js"><link rel="prefetch" href="/docs/assets/js/18.fb44ae63.js"><link rel="prefetch" href="/docs/assets/js/19.1a384a56.js"><link rel="prefetch" href="/docs/assets/js/20.c3fd2403.js"><link rel="prefetch" href="/docs/assets/js/21.0f8d82c2.js"><link rel="prefetch" href="/docs/assets/js/22.997f814b.js"><link rel="prefetch" href="/docs/assets/js/23.e99fc4fb.js"><link rel="prefetch" href="/docs/assets/js/24.a5ea8694.js"><link rel="prefetch" href="/docs/assets/js/26.b41fd34b.js"><link rel="prefetch" href="/docs/assets/js/27.4170579d.js"><link rel="prefetch" href="/docs/assets/js/28.dc7c028a.js"><link rel="prefetch" href="/docs/assets/js/29.d5feefd1.js"><link rel="prefetch" href="/docs/assets/js/3.753f60e9.js"><link rel="prefetch" href="/docs/assets/js/30.e4c0c578.js"><link rel="prefetch" href="/docs/assets/js/31.8bda91a8.js"><link rel="prefetch" href="/docs/assets/js/32.fe9e4af2.js"><link rel="prefetch" href="/docs/assets/js/33.09d9b618.js"><link rel="prefetch" href="/docs/assets/js/34.09710b5d.js"><link rel="prefetch" href="/docs/assets/js/35.69f8dd63.js"><link rel="prefetch" href="/docs/assets/js/36.aca157ec.js"><link rel="prefetch" href="/docs/assets/js/37.e5d95f02.js"><link rel="prefetch" href="/docs/assets/js/38.555a01b0.js"><link rel="prefetch" href="/docs/assets/js/39.2319303e.js"><link rel="prefetch" href="/docs/assets/js/4.f1b90a9c.js"><link rel="prefetch" href="/docs/assets/js/40.85dca416.js"><link rel="prefetch" href="/docs/assets/js/41.61fd7ba1.js"><link rel="prefetch" href="/docs/assets/js/42.4af52951.js"><link rel="prefetch" href="/docs/assets/js/43.9aac0ca7.js"><link rel="prefetch" href="/docs/assets/js/44.9b8ef825.js"><link rel="prefetch" href="/docs/assets/js/45.22cab614.js"><link rel="prefetch" href="/docs/assets/js/46.08dbd14c.js"><link rel="prefetch" href="/docs/assets/js/47.48699451.js"><link rel="prefetch" href="/docs/assets/js/48.feea7b15.js"><link rel="prefetch" href="/docs/assets/js/49.d1ec5f48.js"><link rel="prefetch" href="/docs/assets/js/5.bb2e5f53.js"><link rel="prefetch" href="/docs/assets/js/50.c21b0937.js"><link rel="prefetch" href="/docs/assets/js/51.0141d889.js"><link rel="prefetch" href="/docs/assets/js/52.e568693e.js"><link rel="prefetch" href="/docs/assets/js/53.53560722.js"><link rel="prefetch" href="/docs/assets/js/54.4288714a.js"><link rel="prefetch" href="/docs/assets/js/55.0b53a78d.js"><link rel="prefetch" href="/docs/assets/js/56.7d19e1b0.js"><link rel="prefetch" href="/docs/assets/js/57.7fdd16ce.js"><link rel="prefetch" href="/docs/assets/js/58.edaac107.js"><link rel="prefetch" href="/docs/assets/js/59.47e1e5cb.js"><link rel="prefetch" href="/docs/assets/js/6.7551a3ec.js"><link rel="prefetch" href="/docs/assets/js/60.74ea52f6.js"><link rel="prefetch" href="/docs/assets/js/61.df7f149d.js"><link rel="prefetch" href="/docs/assets/js/62.4772ede3.js"><link rel="prefetch" href="/docs/assets/js/63.9718cdf7.js"><link rel="prefetch" href="/docs/assets/js/64.4d5b14c0.js"><link rel="prefetch" href="/docs/assets/js/65.5282e75c.js"><link rel="prefetch" href="/docs/assets/js/66.03ae7250.js"><link rel="prefetch" href="/docs/assets/js/67.bd2b90aa.js"><link rel="prefetch" href="/docs/assets/js/68.72a19020.js"><link rel="prefetch" href="/docs/assets/js/69.70040cf3.js"><link rel="prefetch" href="/docs/assets/js/7.1806fdef.js"><link rel="prefetch" href="/docs/assets/js/70.1e42849e.js"><link rel="prefetch" href="/docs/assets/js/71.e8ee8410.js"><link rel="prefetch" href="/docs/assets/js/72.32f433ac.js"><link rel="prefetch" href="/docs/assets/js/73.4ec9d601.js"><link rel="prefetch" href="/docs/assets/js/74.38324d55.js"><link rel="prefetch" href="/docs/assets/js/75.15903373.js"><link rel="prefetch" href="/docs/assets/js/76.b6697f6e.js"><link rel="prefetch" href="/docs/assets/js/77.c4aa7c7b.js"><link rel="prefetch" href="/docs/assets/js/78.841456b3.js"><link rel="prefetch" href="/docs/assets/js/79.791f25d3.js"><link rel="prefetch" href="/docs/assets/js/8.22845c8b.js"><link rel="prefetch" href="/docs/assets/js/80.ce938d83.js"><link rel="prefetch" href="/docs/assets/js/81.b10aa5d1.js"><link rel="prefetch" href="/docs/assets/js/82.ec26ddfd.js"><link rel="prefetch" href="/docs/assets/js/83.042ed5eb.js"><link rel="prefetch" href="/docs/assets/js/84.074c359f.js"><link rel="prefetch" href="/docs/assets/js/85.9cfca185.js"><link rel="prefetch" href="/docs/assets/js/86.e9cf185b.js"><link rel="prefetch" href="/docs/assets/js/87.40c63c75.js"><link rel="prefetch" href="/docs/assets/js/88.431ecc87.js"><link rel="prefetch" href="/docs/assets/js/89.4010e2df.js"><link rel="prefetch" href="/docs/assets/js/9.c2a53714.js"><link rel="prefetch" href="/docs/assets/js/90.483bdbb7.js"><link rel="prefetch" href="/docs/assets/js/91.9dfaad08.js"><link rel="prefetch" href="/docs/assets/js/92.21001a7d.js"><link rel="prefetch" href="/docs/assets/js/93.f14a89f0.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.eb47bffd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><img src="logo.webp" alt="Hzml Code-Book" class="logo"> <span class="site-name can-hide">Hzml Code-Book</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GoLang相关" class="dropdown-title"><span class="title">GoLang相关</span> <span class="arrow down"></span></button> <button type="button" aria-label="GoLang相关" class="mobile-dropdown-title"><span class="title">GoLang相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/golang/basic/" class="nav-link">
  GoLang基础
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java相关" class="dropdown-title"><span class="title">Java相关</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java相关" class="mobile-dropdown-title"><span class="title">Java相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/java/basic/" class="nav-link">
  Java基础
</a></li><li class="dropdown-item"><!----> <a href="/docs/java/jvm/" class="nav-link">
  JVM
</a></li><li class="dropdown-item"><!----> <a href="/docs/java/spring/" class="nav-link">
  Spring相关
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaScript相关" class="dropdown-title"><span class="title">JavaScript相关</span> <span class="arrow down"></span></button> <button type="button" aria-label="JavaScript相关" class="mobile-dropdown-title"><span class="title">JavaScript相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/js/入门/" class="nav-link">
  入门
</a></li><li class="dropdown-item"><!----> <a href="/docs/js/es6/" class="nav-link">
  es6
</a></li><li class="dropdown-item"><!----> <a href="/docs/js/typescript/" class="nav-link">
  typescript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端开发" class="dropdown-title"><span class="title">前端开发</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端开发" class="mobile-dropdown-title"><span class="title">前端开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/frontend/basic/" class="nav-link">
  前端基础
</a></li><li class="dropdown-item"><!----> <a href="/docs/frontend/browser/" class="nav-link">
  浏览器
</a></li><li class="dropdown-item"><!----> <a href="/docs/frontend/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/docs/frontend/react/" class="nav-link">
  React
</a></li></ul></div></div><div class="nav-item"><a href="/docs/docker/" class="nav-link router-link-active">
  Docker
</a></div><div class="nav-item"><a href="/docs/linux/" class="nav-link">
  Linux
</a></div><div class="nav-item"><a href="/docs/blockchain/" class="nav-link">
  Blockchain
</a></div><div class="nav-item"><a href="/docs/cryptograph/" class="nav-link">
  密码学
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CS" class="dropdown-title"><span class="title">CS</span> <span class="arrow down"></span></button> <button type="button" aria-label="CS" class="mobile-dropdown-title"><span class="title">CS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/cs/computer-architecture/" class="nav-link">
  计算机组成原理
</a></li><li class="dropdown-item"><!----> <a href="/docs/cs/operating-system/" class="nav-link">
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/docs/cs/computer-network/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/docs/docker/dockerfile/.html" class="nav-link">
  算法
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发工具" class="dropdown-title"><span class="title">开发工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发工具" class="mobile-dropdown-title"><span class="title">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/vscode/" class="nav-link">
  VSCode
</a></li></ul></div></div><div class="nav-item"><a href="/docs/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="https://github.com/shengzhou1216/docs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GoLang相关" class="dropdown-title"><span class="title">GoLang相关</span> <span class="arrow down"></span></button> <button type="button" aria-label="GoLang相关" class="mobile-dropdown-title"><span class="title">GoLang相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/golang/basic/" class="nav-link">
  GoLang基础
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java相关" class="dropdown-title"><span class="title">Java相关</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java相关" class="mobile-dropdown-title"><span class="title">Java相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/java/basic/" class="nav-link">
  Java基础
</a></li><li class="dropdown-item"><!----> <a href="/docs/java/jvm/" class="nav-link">
  JVM
</a></li><li class="dropdown-item"><!----> <a href="/docs/java/spring/" class="nav-link">
  Spring相关
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaScript相关" class="dropdown-title"><span class="title">JavaScript相关</span> <span class="arrow down"></span></button> <button type="button" aria-label="JavaScript相关" class="mobile-dropdown-title"><span class="title">JavaScript相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/js/入门/" class="nav-link">
  入门
</a></li><li class="dropdown-item"><!----> <a href="/docs/js/es6/" class="nav-link">
  es6
</a></li><li class="dropdown-item"><!----> <a href="/docs/js/typescript/" class="nav-link">
  typescript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端开发" class="dropdown-title"><span class="title">前端开发</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端开发" class="mobile-dropdown-title"><span class="title">前端开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/frontend/basic/" class="nav-link">
  前端基础
</a></li><li class="dropdown-item"><!----> <a href="/docs/frontend/browser/" class="nav-link">
  浏览器
</a></li><li class="dropdown-item"><!----> <a href="/docs/frontend/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/docs/frontend/react/" class="nav-link">
  React
</a></li></ul></div></div><div class="nav-item"><a href="/docs/docker/" class="nav-link router-link-active">
  Docker
</a></div><div class="nav-item"><a href="/docs/linux/" class="nav-link">
  Linux
</a></div><div class="nav-item"><a href="/docs/blockchain/" class="nav-link">
  Blockchain
</a></div><div class="nav-item"><a href="/docs/cryptograph/" class="nav-link">
  密码学
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CS" class="dropdown-title"><span class="title">CS</span> <span class="arrow down"></span></button> <button type="button" aria-label="CS" class="mobile-dropdown-title"><span class="title">CS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/cs/computer-architecture/" class="nav-link">
  计算机组成原理
</a></li><li class="dropdown-item"><!----> <a href="/docs/cs/operating-system/" class="nav-link">
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/docs/cs/computer-network/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/docs/docker/dockerfile/.html" class="nav-link">
  算法
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发工具" class="dropdown-title"><span class="title">开发工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发工具" class="mobile-dropdown-title"><span class="title">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/vscode/" class="nav-link">
  VSCode
</a></li></ul></div></div><div class="nav-item"><a href="/docs/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="https://github.com/shengzhou1216/docs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Dockerfile中的RUN、CMD、ENTRYPOINT比较</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/docker/dockerfile/Dockerfile%E4%B8%AD%E7%9A%84RUN%E3%80%81CMD%E3%80%81ENTRYPOINT%E6%AF%94%E8%BE%83.html#run命令" class="sidebar-link">RUN命令</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/docker/dockerfile/Dockerfile%E4%B8%AD%E7%9A%84RUN%E3%80%81CMD%E3%80%81ENTRYPOINT%E6%AF%94%E8%BE%83.html#cmd" class="sidebar-link">CMD</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/docker/dockerfile/Dockerfile%E4%B8%AD%E7%9A%84RUN%E3%80%81CMD%E3%80%81ENTRYPOINT%E6%AF%94%E8%BE%83.html#entrypoint" class="sidebar-link">ENTRYPOINT</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/docker/dockerfile/Dockerfile%E4%B8%AD%E7%9A%84RUN%E3%80%81CMD%E3%80%81ENTRYPOINT%E6%AF%94%E8%BE%83.html#验证例子" class="sidebar-link">验证例子</a></li></ul></li><li><a href="/docs/docker/dockerfile/Dockerfile%E4%B8%AD%E7%9A%84RUN%E3%80%81CMD%E3%80%81ENTRYPOINT%E6%AF%94%E8%BE%83.html#理解cmd和entrypoint如何交互" class="sidebar-link">理解CMD和ENTRYPOINT如何交互</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/docker/dockerfile/Dockerfile%E4%B8%AD%E7%9A%84RUN%E3%80%81CMD%E3%80%81ENTRYPOINT%E6%AF%94%E8%BE%83.html#简而言之" class="sidebar-link">简而言之</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/docker/dockerfile/Dockerfile%E4%B8%AD%E7%9A%84RUN%E3%80%81CMD%E3%80%81ENTRYPOINT%E6%AF%94%E8%BE%83.html#参考" class="sidebar-link">参考</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="dockerfile中的run、cmd、entrypoint比较"><a href="#dockerfile中的run、cmd、entrypoint比较" class="header-anchor">#</a> Dockerfile中的RUN、CMD、ENTRYPOINT比较</h1> <p></p><div class="table-of-contents"><ul><li><a href="#run命令">RUN命令</a></li><li><a href="#cmd">CMD</a></li><li><a href="#entrypoint">ENTRYPOINT</a><ul><li><a href="#验证例子">验证例子</a><ul><li><a href="#_1-docker-run-image-的命令参数会被追加到-exec-形式的-entrypoint-的所有参数之后">1.docker run (image)的命令参数会被追加到 exec 形式的 ENTRYPOINT 的所有参数之后</a></li><li><a href="#_2-docker-run会覆盖所有使用cmd指定的参数">2.docker run会覆盖所有使用CMD指定的参数</a></li><li><a href="#_3-使用-docker-run-entrypoint-来覆盖-entrypoint-指令。">3.使用 docker run --entrypoint 来覆盖 ENTRYPOINT 指令。</a></li><li><a href="#_4-shell-形式可以防止使用任何cmd或run命令行参数">4.shell 形式可以防止使用任何CMD或run命令行参数</a></li><li><a href="#_5-shell-形式的entrypoint将作为-bin-sh-c-的一个子命令启动">5.shell 形式的ENTRYPOINT将作为/bin/sh -c的一个子命令启动</a><ul><li><a href="#exec形式的entrypoint">exec形式的ENTRYPOINT</a></li><li><a href="#shell形式的entrypoint">shell形式的ENTRYPOINT</a></li></ul></li></ul></li></ul></li><li><a href="#理解cmd和entrypoint如何交互">理解CMD和ENTRYPOINT如何交互</a></li><li><a href="#简而言之">简而言之</a></li><li><a href="#参考">参考</a></li></ul></div><p></p> <h2 id="run命令"><a href="#run命令" class="header-anchor">#</a> RUN命令</h2> <p>RUN有2中形式:</p> <ul><li><code>RUN &lt;command&gt;</code> (shell形式，command在shell(linux上默认是 <code>/bin/sh -c</code>, windows上默认是<code>cmd /S /C</code>)中运行)</li> <li><code>RUN [&quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot;]</code>（exec 形式）</li></ul> <p><code>RUN</code> 指令会在当前镜像上新建一个layer，然后执行命名并提交结果。被提交的镜像用于下一步指令。</p> <p>分层 <code>RUN</code> 指令和生成提交符合 Docker 的核心概念，其中提交成本低，并且可以从镜像历史中的任何点创建容器，就像源代码控制一样。</p> <p><em>exec</em> 形式可以避免 shell 字符串修改，并可以使用不包含指定 shell 可执行文件的基本映像来运行命令。</p> <p>可以使用 <code>SHELL</code> 命令更改 <em>shell</em> 形式的默认 shell。</p> <p>在 <em>shell</em> 形式中，可以使用 \（反斜杠）将单个 RUN 指令延续到下一行。例如，考虑以下两行：</p> <div class="language-dockerfile extra-class"><pre class="language-dockerfile"><code><span class="token keyword">RUN</span> /bin/bash <span class="token punctuation">-</span>c <span class="token string">'source $HOME/.bashrc; \
echo $HOME'</span>
</code></pre></div><p>等价于</p> <div class="language-dockerfile extra-class"><pre class="language-dockerfile"><code><span class="token keyword">RUN</span> /bin/bash <span class="token punctuation">-</span>c <span class="token string">'source $HOME/.bashrc; echo $HOME'</span>
</code></pre></div><p>要使用除“/bin/sh”之外的不同 shell，请使用传入所需 shell 的 <em>exec</em> 形式。例如：</p> <div class="language-dockerfile extra-class"><pre class="language-dockerfile"><code><span class="token keyword">RUN</span> <span class="token punctuation">[</span><span class="token string">&quot;/bin/bash&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-c&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;echo hello&quot;</span><span class="token punctuation">]</span>
</code></pre></div><blockquote><p>注意:</p> <p>exec 形式被解析为 JSON 数组，这意味着必须在单词周围使用双引号 (“) 而不是单引号 (‘)。</p></blockquote> <p>与shell形式不同，exec形式不调用命令shell。这意味着正常的shell处理不会发生。例如，RUN [ &quot;echo&quot;, &quot;$HOME&quot; ] 不会对 $HOME进行变量替换。如果你想进行shell处理，那么要么使用shell形式，要么直接执行一个shell，例如。RUN [ &quot;sh&quot;, &quot;-c&quot;, &quot;echo ​$HOME&quot; ] 。当使用exec形式并直接执行shell时，就像shell形式的情况一样，是shell在做环境变量的扩展，而不是docker。</p> <blockquote><p>注意:</p> <p>在JSON形式中，有必要转义反斜线。这在Windows上尤其重要，因为反斜杠是路径分隔符。否则，下面这一行会因为不是有效的JSON而被视为shell形式，并以一种意外的方式失败。</p> <div class="language-dockerfile extra-class"><pre class="language-dockerfile"><code><span class="token keyword">RUN</span> <span class="token punctuation">[</span><span class="token string">&quot;c:\windows\system32\tasklist.exe&quot;</span><span class="token punctuation">]</span>
</code></pre></div><p>正确的语法是:</p> <div class="language-dockerfile extra-class"><pre class="language-dockerfile"><code><span class="token keyword">RUN</span> <span class="token punctuation">[</span><span class="token string">&quot;c:\\windows\\system32\\tasklist.exe&quot;</span><span class="token punctuation">]</span>
</code></pre></div></blockquote> <p>RUN指令的缓存在下次构建时不会自动失效。像<code>RUN apt-get dist-upgrade -y</code>这样的指令的缓存会在下次构建时被重新使用。RUN指令的缓存可以通过使用<code>--no-cache</code>标志来失效，例如<code>docker build --no-cache</code>。</p> <p>更多信息请参见<a href="https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/" target="_blank" rel="noopener noreferrer">Dockerfile最佳实践指南<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>RUN指令的缓存可以通过ADD和COPY指令失效。</p> <h2 id="cmd"><a href="#cmd" class="header-anchor">#</a> CMD</h2> <p>CMD指令有三种形式:</p> <ul><li><code>CMD [&quot;executable&quot;,&quot;param1&quot;,&quot;param2&quot;]</code> (<em>exec</em> 形式，首选形式)</li> <li><code>CMD [&quot;param1&quot;,&quot;param2&quot;]</code> ( 作为<em>ENTRYPOINT的默认参数</em>)</li> <li><code>CMD command param1 param2</code> (<em>shell</em> 形式)</li></ul> <p>一个Dockerfile中只能有一个 CMD 指令。如果有多个CMD指令，那么只有最后一个CMD指令会生效。</p> <p><strong>CMD的主要目的是为执行中的容器提供默认值</strong>。这些默认值可以包括一个可执行文件，也可以省略可执行文件，在这种情况下，你必须同时指定一个ENTRYPOINT指令。</p> <p>如果CMD被用来为ENTRYPOINT指令提供默认参数，CMD和ENTRYPOINT指令都应该用JSON数组格式来指定。</p> <blockquote><p>注意:</p> <p>exec 形式被解析为 JSON 数组，这意味着必须在单词周围使用双引号 (“) 而不是单引号 (‘)。</p></blockquote> <p>与<em>shell</em>形式不同，<strong><em>exec</em>形式不调用命令shell</strong>。这意味着正常的shell处理不会发生。例如，CMD [ &quot;echo&quot;, &quot;$HOME&quot;] 不会对$HOME进行变量替换。<strong>如果你想进行shell处理，那么要么使用<em>shell</em>形式，要么直接执行一个shell</strong>，例如。CMD [ &quot;sh&quot;, &quot;-c&quot;, &quot;echo ​$HOME&quot; ] 。当使用<em>exec</em>形式并直接执行shell时，就像shell形式的情况一样，是shell在做环境变量扩展，而不是docker。</p> <p><strong>当在<em>shell</em>或<em>exec</em>格式中使用时，CMD指令设置运行镜像时要执行的命令。</strong></p> <p><strong>如果你使用CMD的<em>shell</em>形式，那么<code>&lt;command&gt;</code>将在<code>/bin/sh -c</code>中执行。</strong></p> <div class="language-dockerfile extra-class"><pre class="language-dockerfile"><code><span class="token keyword">FROM</span> ubuntu
<span class="token keyword">CMD</span> echo <span class="token string">&quot;This is a test.&quot;</span> <span class="token punctuation">|</span> wc <span class="token punctuation">-</span>
</code></pre></div><p>如果你想在没有shell的情况下运行你的<code>&lt;command&gt;</code>，那么你必须将命令表达为一个JSON数组，并给出可执行文件的完整路径。这种数组形式是CMD的首选格式。任何额外的参数必须在数组中单独表示为字符串。</p> <div class="language-dockerfile extra-class"><pre class="language-dockerfile"><code><span class="token keyword">FROM</span> ubuntu
<span class="token keyword">CMD</span> <span class="token punctuation">[</span><span class="token string">&quot;/usr/bin/wc&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;--help&quot;</span><span class="token punctuation">]</span>
</code></pre></div><p>如果你希望你的容器每次都运行相同的可执行文件，那么你应该考虑将 ENTRYPOINT 与 CMD 结合使用。参见<a href="https://docs.docker.com/engine/reference/builder/#entrypoint" target="_blank" rel="noopener noreferrer">ENTRYPOINT<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p><strong>如果用户指定参数给docker run，那么它们将覆盖CMD中指定的默认值。</strong></p> <blockquote><p>注意:</p> <p>不要把RUN和CMD混淆。RUN实际上是运行一个命令并提交结果；CMD在构建时不执行任何东西，而是为镜像指定要执行的命令。</p></blockquote> <h2 id="entrypoint"><a href="#entrypoint" class="header-anchor">#</a> ENTRYPOINT</h2> <p><code>ENTRYPOINT</code> 有两种形式:</p> <ul><li><p><em>exec</em> 形式 ，这是首选形式:</p> <div class="language-dockerfile extra-class"><pre class="language-dockerfile"><code><span class="token keyword">ENTRYPOINT</span> <span class="token punctuation">[</span><span class="token string">&quot;executable&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;param1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;param2&quot;</span><span class="token punctuation">]</span>
</code></pre></div></li> <li><p><em>shell</em>形式</p> <div class="language-dockerfile extra-class"><pre class="language-dockerfile"><code><span class="token keyword">ENTRYPOINT</span> command param1 param2
</code></pre></div></li></ul> <p>一个ENTRYPOINT允许你配置一个将作为可执行文件运行的容器。</p> <p>例如，下面是启动nginx的默认内容，监听端口为80：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker run -i -t --rm -p <span class="token number">80</span>:80 nginx
</code></pre></div><p><strong><code>docker run (image)</code> 的命令参数会被追加到 exec 形式的 ENTRYPOINT 的所有参数之后，并且会覆盖所有使用CMD指定的参数。<strong>这样就可以给entry point传递参数了,即，<code>docker run (image) -d</code> 会传递 <code>-d</code> 参数给 entry point。你可以</strong>使用 <code>docker run --entrypoint</code> 来覆盖 ENTRYPOINT 指令。</strong></p> <p><strong><em>shell</em> 形式可以防止使用任何CMD或run命令行参数</strong>，但缺点是你的ENTRYPOINT将作为<code>/bin/sh -c</code>的一个子命令启动，它不传递信号。这意味着可执行文件不会是容器的<code>PID 1</code>--也不会收到Unix信号--所以你的可执行文件不会收到来自docker stop &lt;container&gt;的<code>SIGTERM</code>。</p> <p><strong>Dockerfile中，只有最后一条ENTRYPOINT指令才有效果。</strong></p> <h3 id="验证例子"><a href="#验证例子" class="header-anchor">#</a> 验证例子</h3> <h4 id="_1-docker-run-image-的命令参数会被追加到-exec-形式的-entrypoint-的所有参数之后"><a href="#_1-docker-run-image-的命令参数会被追加到-exec-形式的-entrypoint-的所有参数之后" class="header-anchor">#</a> 1.docker run (image)的命令参数会被追加到 exec 形式的 ENTRYPOINT 的所有参数之后</h4> <p>1.编写Dockerfile:</p> <div class="language-dockerfile extra-class"><pre class="language-dockerfile"><code><span class="token keyword">FROM</span> ubuntu<span class="token punctuation">:</span>focal
<span class="token keyword">ENTRYPOINT</span> <span class="token punctuation">[</span><span class="token string">&quot;ls&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;-l&quot;</span><span class="token punctuation">]</span>
</code></pre></div><p>2.构建镜像</p> <div class="language-bash extra-class"><pre class="language-bash"><code>docker build -t study-dockerfile <span class="token builtin class-name">.</span>
</code></pre></div><p>3.测试</p> <ul><li><p>不追加参数:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>docker run -it --rm study-dockerfile
</code></pre></div><p>结果:</p> <div class="language- extra-class"><pre class="language-text"><code>total 48
lrwxrwxrwx   1 root root    7 Apr 16 05:11 bin -&gt; usr/bin
drwxr-xr-x   2 root root 4096 Apr 15  2020 boot
drwxr-xr-x   5 root root  360 Jul  2 11:04 dev
....
</code></pre></div></li> <li><p>追加参数 <code>-ah</code></p> <div class="language-bash extra-class"><pre class="language-bash"><code>docker run -it --rm study-dockerfile -ah
</code></pre></div><p>结果:</p> <div class="language- extra-class"><pre class="language-text"><code>total 56K
drwxr-xr-x   1 root root 4.0K Jul  2 11:06 .
drwxr-xr-x   1 root root 4.0K Jul  2 11:06 ..
-rwxr-xr-x   1 root root    0 Jul  2 11:06 .dockerenv
...
</code></pre></div><p>从输出结果可以看出，追加参数生效了</p></li></ul> <h4 id="_2-docker-run会覆盖所有使用cmd指定的参数"><a href="#_2-docker-run会覆盖所有使用cmd指定的参数" class="header-anchor">#</a> 2.docker run会覆盖所有使用CMD指定的参数</h4> <p>1.编写Dockerfile</p> <div class="language-dockerfile extra-class"><pre class="language-dockerfile"><code><span class="token keyword">FROM</span> ubuntu<span class="token punctuation">:</span>focal
<span class="token keyword">ENTRYPOINT</span> <span class="token punctuation">[</span><span class="token string">&quot;ls&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;-l&quot;</span><span class="token punctuation">]</span>
<span class="token keyword">CMD</span> <span class="token punctuation">[</span><span class="token string">&quot;-a&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;-h&quot;</span><span class="token punctuation">]</span>
</code></pre></div><p>这里，使用CMD给ENTRYPOINT传参</p> <p>2.构建镜像</p> <div class="language-bash extra-class"><pre class="language-bash"><code>docker build -t study-dockerfile <span class="token builtin class-name">.</span>
</code></pre></div><p>3.测试</p> <ul><li><p>不追加参数</p> <div class="language-bash extra-class"><pre class="language-bash"><code>docker run -it --rm study-dockerfile                                                  
</code></pre></div><p>结果:</p> <div class="language- extra-class"><pre class="language-text"><code>total 56K
drwxr-xr-x   1 root root 4.0K Jul  2 11:12 .
drwxr-xr-x   1 root root 4.0K Jul  2 11:12 ..
-rwxr-xr-x   1 root root    0 Jul  2 11:12 .dockerenv
lrwxrwxrwx   1 root root    7 Apr 16 05:11 bin -&gt; usr/bin
...
</code></pre></div></li> <li><p>追加参数</p> <div class="language-bash extra-class"><pre class="language-bash"><code>docker run -it --rm study-dockerfile -a
</code></pre></div><p>结果：</p> <div class="language- extra-class"><pre class="language-text"><code>total 56
drwxr-xr-x   1 root root 4096 Jul  2 11:12 .
drwxr-xr-x   1 root root 4096 Jul  2 11:12 ..
-rwxr-xr-x   1 root root    0 Jul  2 11:12 .dockerenv
lrwxrwxrwx   1 root root    7 Apr 16 05:11 bin -&gt; usr/bin
...
</code></pre></div><p>从输出结果可以看出，CMD中指定的所有参数都被 docker run 中的 -a参数覆盖了。</p></li></ul> <h4 id="_3-使用-docker-run-entrypoint-来覆盖-entrypoint-指令。"><a href="#_3-使用-docker-run-entrypoint-来覆盖-entrypoint-指令。" class="header-anchor">#</a> 3.使用 <code>docker run --entrypoint</code> 来覆盖 ENTRYPOINT 指令。</h4> <p>使用 <code>--entrypoint</code>:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>docker run -it --rm --entrypoint <span class="token function">ls</span> study-dockerfile
</code></pre></div><p>运行结果:</p> <div class="language- extra-class"><pre class="language-text"><code>bin   dev  home  lib32	libx32	mnt  proc  run	 srv  tmp  var
boot  etc  lib	 lib64	media	opt  root  sbin  sys  usr
</code></pre></div><p>从输出结果可以看出，Dockerfile中的ENTRYPOINT指令被覆盖了。</p> <h4 id="_4-shell-形式可以防止使用任何cmd或run命令行参数"><a href="#_4-shell-形式可以防止使用任何cmd或run命令行参数" class="header-anchor">#</a> 4.<em>shell</em> 形式可以防止使用任何CMD或run命令行参数</h4> <p>1.编写Dockerfile</p> <div class="language-dockerfile extra-class"><pre class="language-dockerfile"><code><span class="token keyword">FROM</span> ubuntu<span class="token punctuation">:</span>focal
<span class="token keyword">ENTRYPOINT</span> ls 
</code></pre></div><p>这里使用的是ENTRYPOINT 的 <em>shell</em>形式</p> <p>2.构建镜像</p> <div class="language-bash extra-class"><pre class="language-bash"><code>docker build -t study-dockerfile <span class="token builtin class-name">.</span>
</code></pre></div><p>3.测试</p> <ul><li><p>不追加参数</p> <div class="language-bash extra-class"><pre class="language-bash"><code>docker run -it --rm study-dockerfile
</code></pre></div><p>结果:</p> <div class="language- extra-class"><pre class="language-text"><code>bin   dev  home  lib32	libx32	mnt  proc  run	 srv  tmp  var
boot  etc  lib	 lib64	media	opt  root  sbin  sys  usr
</code></pre></div></li> <li><p>追加参数</p> <div class="language-bash extra-class"><pre class="language-bash"><code>docker run -it --rm study-dockerfile -a
</code></pre></div><p>结果:</p> <div class="language- extra-class"><pre class="language-text"><code>bin   dev  home  lib32	libx32	mnt  proc  run	 srv  tmp  var
boot  etc  lib	 lib64	media	opt  root  sbin  sys  usr
</code></pre></div><p>从输出结果可以看出，<code>docker run</code>中指定的 <code>-a</code>参数没有生效</p></li></ul> <h4 id="_5-shell-形式的entrypoint将作为-bin-sh-c的一个子命令启动"><a href="#_5-shell-形式的entrypoint将作为-bin-sh-c的一个子命令启动" class="header-anchor">#</a> 5.<em>shell</em> 形式的ENTRYPOINT将作为<code>/bin/sh -c</code>的一个子命令启动</h4> <h5 id="exec形式的entrypoint"><a href="#exec形式的entrypoint" class="header-anchor">#</a> exec形式的ENTRYPOINT</h5> <p>1.编写Dockerfile</p> <div class="language-dockerfile extra-class"><pre class="language-dockerfile"><code><span class="token keyword">FROM</span> ubuntu<span class="token punctuation">:</span>focal
<span class="token keyword">ENTRYPOINT</span> watch <span class="token punctuation">-</span>n 1 ls
</code></pre></div><p>2.构建镜像</p> <div class="language-bash extra-class"><pre class="language-bash"><code>docker build -t study-dockerfile <span class="token builtin class-name">.</span> 
</code></pre></div><p>3.验证</p> <p>启动容器</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker run -itd --rm --name study-dockerfile study-dockerfile
</code></pre></div><p>使用<code>docker top &lt;container&gt;</code>命令查看容器中的进程:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker <span class="token function">top</span> study-dockerfile
<span class="token environment constant">UID</span>  PID    <span class="token environment constant">PPID</span>  CMD
root <span class="token number">785275</span> <span class="token number">785255</span>  <span class="token function">watch</span> -n <span class="token number">1</span> <span class="token function">ls</span>
</code></pre></div><h5 id="shell形式的entrypoint"><a href="#shell形式的entrypoint" class="header-anchor">#</a> shell形式的ENTRYPOINT</h5> <p>1.编写Dockerfile</p> <div class="language-dockerfile extra-class"><pre class="language-dockerfile"><code><span class="token keyword">FROM</span> ubuntu<span class="token punctuation">:</span>focal
<span class="token keyword">ENTRYPOINT</span> watch <span class="token punctuation">-</span>n 1 ls
</code></pre></div><p>2.构建镜像</p> <div class="language-bash extra-class"><pre class="language-bash"><code>docker build -t study-dockerfile <span class="token builtin class-name">.</span> 
</code></pre></div><p>3.验证</p> <p>启动容器</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker run -itd --rm --name study-dockerfile study-dockerfile
</code></pre></div><p>使用<code>docker top &lt;container&gt;</code>命令查看容器中的进程:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker <span class="token function">top</span> study-dockerfile
<span class="token environment constant">UID</span>   PID     <span class="token environment constant">PPID</span>   CMD
root  <span class="token number">787440</span>  <span class="token number">787419</span>    /bin/sh -c <span class="token function">watch</span> -n <span class="token number">1</span> <span class="token function">ls</span>
root  <span class="token number">787487</span>  <span class="token number">787440</span>    <span class="token function">watch</span> -n <span class="token number">1</span> <span class="token function">ls</span>
</code></pre></div><p>从上面的输出可以看到 <code>watch -n 1 ls</code> 是 <code>/bin/sh -c watch -n 1 ls</code>的一个子进程。</p> <p>这时，也可以在主机上查看相应进程:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">ps</span> -aux <span class="token operator">|</span> <span class="token function">grep</span> <span class="token function">watch</span>
root         <span class="token number">171</span>  <span class="token number">0</span>?   <span class="token number">0</span>:00 <span class="token punctuation">[</span>watchdogd<span class="token punctuation">]</span>
sheng     <span class="token number">763889</span>  <span class="token number">76288</span> ?         <span class="token number">0</span>:00 /usr/share/code/code /usr/share/code/resources/app/out/bootstrap-fork --type<span class="token operator">=</span>watcherService
root      <span class="token number">787440</span>  <span class="token number">600</span> pts/0      <span class="token number">0</span>:00 /bin/sh -c <span class="token function">watch</span> -n <span class="token number">1</span> <span class="token function">ls</span>
root      <span class="token number">787487</span>  <span class="token number">2492</span> pts/0      <span class="token number">0</span>:00 <span class="token function">watch</span> -n <span class="token number">1</span> <span class="token function">ls</span>
sheng     <span class="token number">787568</span>  <span class="token number">2704</span> pts/4      <span class="token number">0</span>:00 <span class="token function">grep</span> --color<span class="token operator">=</span>auto --exclude-dir<span class="token operator">=</span>.bzr --exclude-dir<span class="token operator">=</span>CVS --exclude-dir<span class="token operator">=</span>.git --exclude-dir<span class="token operator">=</span>.hg --exclude-dir<span class="token operator">=</span>.svn --exclude-dir<span class="token operator">=</span>.idea --exclude-dir<span class="token operator">=</span>.tox <span class="token function">watch</span>
</code></pre></div><p>现在，停止容器:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker stop study-dockerfile
</code></pre></div><p>再查看一下主机上响应的进程, 发现在第一次使用<code>docker stop</code>命令的时候，子进程在容器停止/删除后并没有退出，但是后面再试的时候，发现子进程在容器停止/删除后也结束了。与预期结果并不相符。</p> <h2 id="理解cmd和entrypoint如何交互"><a href="#理解cmd和entrypoint如何交互" class="header-anchor">#</a> 理解CMD和ENTRYPOINT如何交互</h2> <p>CMD和ENTRYPOINT指令<strong>都定义了当运行一个容器时要执行的命令</strong>。它们合作的几个规则如下:</p> <ol><li>Dockerfile应该至少指定 CMD 和 ENTRYPOINT 中的一个</li> <li>当使用容器做为可执行文件时应该使用ENTRYPOINT</li> <li>CMD应该用于一种为ENTRYPOINT命令定义默认参数的方式 或 用于在容器中执行 ad-hoc命令</li> <li>当用其他参数运行容器时，CMD会被覆盖</li></ol> <p>下表显示了不同的ENTRYPOINT/CMD组合会执行什么命令:</p> <table><thead><tr><th style="text-align:left;"></th> <th style="text-align:left;">No ENTRYPOINT</th> <th style="text-align:left;">ENTRYPOINT exec_entry p1_entry</th> <th>ENTRYPOINT [“exec_entry”, “p1_entry”]</th></tr></thead> <tbody><tr><td style="text-align:left;"><strong>No CMD</strong></td> <td style="text-align:left;"><em>error, not allowed</em></td> <td style="text-align:left;">/bin/sh -c exec_entry p1_entry</td> <td>exec_entry p1_entry</td></tr> <tr><td style="text-align:left;"><strong>CMD [“exec_cmd”, “p1_cmd”]</strong></td> <td style="text-align:left;">exec_cmd p1_cmd</td> <td style="text-align:left;">/bin/sh -c exec_entry p1_entry</td> <td>exec_entry p1_entry exec_cmd p1_cmd</td></tr> <tr><td style="text-align:left;"><strong>CMD [“p1_cmd”, “p2_cmd”]</strong></td> <td style="text-align:left;">p1_cmd p2_cmd</td> <td style="text-align:left;">/bin/sh -c exec_entry p1_entry</td> <td>exec_entry p1_entry p1_cmd p2_cmd</td></tr> <tr><td style="text-align:left;"><strong>CMD exec_cmd p1_cmd</strong></td> <td style="text-align:left;">/bin/sh -c exec_cmd p1_cmd</td> <td style="text-align:left;">/bin/sh -c exec_entry p1_entry</td> <td>exec_entry p1_entry /bin/sh -c exec_cmd p1_cmd</td></tr></tbody></table> <blockquote><p>注意:</p> <p>如果CMD是从基础镜像中定义的，设置ENTRYPOINT将把CMD重置为一个空值。在这种情况下，CMD必须在当前镜像中定义才有意义。</p></blockquote> <h2 id="简而言之"><a href="#简而言之" class="header-anchor">#</a> 简而言之</h2> <ul><li>RUN: （在构建镜像阶段执行）它在一个新的layer中执行命令，并创建一个新的镜像。例如，此命令通常用于安装软件包。</li> <li>CMD: （在容器运行时执行）设置默认命令和/或参数，它能够被<code>docker run</code>命令中的参数覆盖</li> <li>ENTRYPOINT:（在容器运行时执行）允许你配置一个将作为可执行文件运行的容器。</li></ul> <h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <ul><li>https://docs.docker.com/engine/reference/builder/</li></ul> <!----></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后一次更新于:</span> <span class="time">7/2/2021, 1:16:23 PM</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/docs/assets/js/app.01c93764.js" defer></script><script src="/docs/assets/js/2.2d8514e9.js" defer></script><script src="/docs/assets/js/25.ae0fe913.js" defer></script>
  </body>
</html>
