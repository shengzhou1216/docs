<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>使用Docker部署mysql | Hzml Code-Book</title>
    <meta name="generator" content="VuePress 1.8.2">
    <script src="https://www.googletagmanager.com/gtag/js?id=G-175K59GC1N" async="true"></script>
    <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            
            gtag('config', 'G-175K59GC1N');
        </script>
    <meta name="description" content="Hzml Code-Book">
    
    <link rel="preload" href="/docs/assets/css/0.styles.eb47bffd.css" as="style"><link rel="preload" href="/docs/assets/js/app.01c93764.js" as="script"><link rel="preload" href="/docs/assets/js/2.2d8514e9.js" as="script"><link rel="preload" href="/docs/assets/js/27.4170579d.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.c7c6a8e3.js"><link rel="prefetch" href="/docs/assets/js/11.c9661a93.js"><link rel="prefetch" href="/docs/assets/js/12.1279196e.js"><link rel="prefetch" href="/docs/assets/js/13.11f069e8.js"><link rel="prefetch" href="/docs/assets/js/14.0d56bfa0.js"><link rel="prefetch" href="/docs/assets/js/15.9c25e017.js"><link rel="prefetch" href="/docs/assets/js/16.b63ae8c6.js"><link rel="prefetch" href="/docs/assets/js/17.3317484b.js"><link rel="prefetch" href="/docs/assets/js/18.fb44ae63.js"><link rel="prefetch" href="/docs/assets/js/19.1a384a56.js"><link rel="prefetch" href="/docs/assets/js/20.c3fd2403.js"><link rel="prefetch" href="/docs/assets/js/21.0f8d82c2.js"><link rel="prefetch" href="/docs/assets/js/22.997f814b.js"><link rel="prefetch" href="/docs/assets/js/23.e99fc4fb.js"><link rel="prefetch" href="/docs/assets/js/24.a5ea8694.js"><link rel="prefetch" href="/docs/assets/js/25.ae0fe913.js"><link rel="prefetch" href="/docs/assets/js/26.b41fd34b.js"><link rel="prefetch" href="/docs/assets/js/28.dc7c028a.js"><link rel="prefetch" href="/docs/assets/js/29.d5feefd1.js"><link rel="prefetch" href="/docs/assets/js/3.753f60e9.js"><link rel="prefetch" href="/docs/assets/js/30.e4c0c578.js"><link rel="prefetch" href="/docs/assets/js/31.8bda91a8.js"><link rel="prefetch" href="/docs/assets/js/32.fe9e4af2.js"><link rel="prefetch" href="/docs/assets/js/33.09d9b618.js"><link rel="prefetch" href="/docs/assets/js/34.09710b5d.js"><link rel="prefetch" href="/docs/assets/js/35.69f8dd63.js"><link rel="prefetch" href="/docs/assets/js/36.aca157ec.js"><link rel="prefetch" href="/docs/assets/js/37.e5d95f02.js"><link rel="prefetch" href="/docs/assets/js/38.555a01b0.js"><link rel="prefetch" href="/docs/assets/js/39.2319303e.js"><link rel="prefetch" href="/docs/assets/js/4.f1b90a9c.js"><link rel="prefetch" href="/docs/assets/js/40.85dca416.js"><link rel="prefetch" href="/docs/assets/js/41.61fd7ba1.js"><link rel="prefetch" href="/docs/assets/js/42.4af52951.js"><link rel="prefetch" href="/docs/assets/js/43.9aac0ca7.js"><link rel="prefetch" href="/docs/assets/js/44.9b8ef825.js"><link rel="prefetch" href="/docs/assets/js/45.22cab614.js"><link rel="prefetch" href="/docs/assets/js/46.08dbd14c.js"><link rel="prefetch" href="/docs/assets/js/47.48699451.js"><link rel="prefetch" href="/docs/assets/js/48.feea7b15.js"><link rel="prefetch" href="/docs/assets/js/49.d1ec5f48.js"><link rel="prefetch" href="/docs/assets/js/5.bb2e5f53.js"><link rel="prefetch" href="/docs/assets/js/50.c21b0937.js"><link rel="prefetch" href="/docs/assets/js/51.0141d889.js"><link rel="prefetch" href="/docs/assets/js/52.e568693e.js"><link rel="prefetch" href="/docs/assets/js/53.53560722.js"><link rel="prefetch" href="/docs/assets/js/54.4288714a.js"><link rel="prefetch" href="/docs/assets/js/55.0b53a78d.js"><link rel="prefetch" href="/docs/assets/js/56.7d19e1b0.js"><link rel="prefetch" href="/docs/assets/js/57.7fdd16ce.js"><link rel="prefetch" href="/docs/assets/js/58.edaac107.js"><link rel="prefetch" href="/docs/assets/js/59.47e1e5cb.js"><link rel="prefetch" href="/docs/assets/js/6.7551a3ec.js"><link rel="prefetch" href="/docs/assets/js/60.74ea52f6.js"><link rel="prefetch" href="/docs/assets/js/61.df7f149d.js"><link rel="prefetch" href="/docs/assets/js/62.4772ede3.js"><link rel="prefetch" href="/docs/assets/js/63.9718cdf7.js"><link rel="prefetch" href="/docs/assets/js/64.4d5b14c0.js"><link rel="prefetch" href="/docs/assets/js/65.5282e75c.js"><link rel="prefetch" href="/docs/assets/js/66.03ae7250.js"><link rel="prefetch" href="/docs/assets/js/67.bd2b90aa.js"><link rel="prefetch" href="/docs/assets/js/68.72a19020.js"><link rel="prefetch" href="/docs/assets/js/69.70040cf3.js"><link rel="prefetch" href="/docs/assets/js/7.1806fdef.js"><link rel="prefetch" href="/docs/assets/js/70.1e42849e.js"><link rel="prefetch" href="/docs/assets/js/71.e8ee8410.js"><link rel="prefetch" href="/docs/assets/js/72.32f433ac.js"><link rel="prefetch" href="/docs/assets/js/73.4ec9d601.js"><link rel="prefetch" href="/docs/assets/js/74.38324d55.js"><link rel="prefetch" href="/docs/assets/js/75.15903373.js"><link rel="prefetch" href="/docs/assets/js/76.b6697f6e.js"><link rel="prefetch" href="/docs/assets/js/77.c4aa7c7b.js"><link rel="prefetch" href="/docs/assets/js/78.841456b3.js"><link rel="prefetch" href="/docs/assets/js/79.791f25d3.js"><link rel="prefetch" href="/docs/assets/js/8.22845c8b.js"><link rel="prefetch" href="/docs/assets/js/80.ce938d83.js"><link rel="prefetch" href="/docs/assets/js/81.b10aa5d1.js"><link rel="prefetch" href="/docs/assets/js/82.ec26ddfd.js"><link rel="prefetch" href="/docs/assets/js/83.042ed5eb.js"><link rel="prefetch" href="/docs/assets/js/84.074c359f.js"><link rel="prefetch" href="/docs/assets/js/85.9cfca185.js"><link rel="prefetch" href="/docs/assets/js/86.e9cf185b.js"><link rel="prefetch" href="/docs/assets/js/87.40c63c75.js"><link rel="prefetch" href="/docs/assets/js/88.431ecc87.js"><link rel="prefetch" href="/docs/assets/js/89.4010e2df.js"><link rel="prefetch" href="/docs/assets/js/9.c2a53714.js"><link rel="prefetch" href="/docs/assets/js/90.483bdbb7.js"><link rel="prefetch" href="/docs/assets/js/91.9dfaad08.js"><link rel="prefetch" href="/docs/assets/js/92.21001a7d.js"><link rel="prefetch" href="/docs/assets/js/93.f14a89f0.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.eb47bffd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><img src="logo.webp" alt="Hzml Code-Book" class="logo"> <span class="site-name can-hide">Hzml Code-Book</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GoLang相关" class="dropdown-title"><span class="title">GoLang相关</span> <span class="arrow down"></span></button> <button type="button" aria-label="GoLang相关" class="mobile-dropdown-title"><span class="title">GoLang相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/golang/basic/" class="nav-link">
  GoLang基础
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java相关" class="dropdown-title"><span class="title">Java相关</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java相关" class="mobile-dropdown-title"><span class="title">Java相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/java/basic/" class="nav-link">
  Java基础
</a></li><li class="dropdown-item"><!----> <a href="/docs/java/jvm/" class="nav-link">
  JVM
</a></li><li class="dropdown-item"><!----> <a href="/docs/java/spring/" class="nav-link">
  Spring相关
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaScript相关" class="dropdown-title"><span class="title">JavaScript相关</span> <span class="arrow down"></span></button> <button type="button" aria-label="JavaScript相关" class="mobile-dropdown-title"><span class="title">JavaScript相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/js/入门/" class="nav-link">
  入门
</a></li><li class="dropdown-item"><!----> <a href="/docs/js/es6/" class="nav-link">
  es6
</a></li><li class="dropdown-item"><!----> <a href="/docs/js/typescript/" class="nav-link">
  typescript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端开发" class="dropdown-title"><span class="title">前端开发</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端开发" class="mobile-dropdown-title"><span class="title">前端开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/frontend/basic/" class="nav-link">
  前端基础
</a></li><li class="dropdown-item"><!----> <a href="/docs/frontend/browser/" class="nav-link">
  浏览器
</a></li><li class="dropdown-item"><!----> <a href="/docs/frontend/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/docs/frontend/react/" class="nav-link">
  React
</a></li></ul></div></div><div class="nav-item"><a href="/docs/docker/" class="nav-link router-link-active">
  Docker
</a></div><div class="nav-item"><a href="/docs/linux/" class="nav-link">
  Linux
</a></div><div class="nav-item"><a href="/docs/blockchain/" class="nav-link">
  Blockchain
</a></div><div class="nav-item"><a href="/docs/cryptograph/" class="nav-link">
  密码学
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CS" class="dropdown-title"><span class="title">CS</span> <span class="arrow down"></span></button> <button type="button" aria-label="CS" class="mobile-dropdown-title"><span class="title">CS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/cs/computer-architecture/" class="nav-link">
  计算机组成原理
</a></li><li class="dropdown-item"><!----> <a href="/docs/cs/operating-system/" class="nav-link">
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/docs/cs/computer-network/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/docs/docker/practice/.html" class="nav-link">
  算法
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发工具" class="dropdown-title"><span class="title">开发工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发工具" class="mobile-dropdown-title"><span class="title">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/vscode/" class="nav-link">
  VSCode
</a></li></ul></div></div><div class="nav-item"><a href="/docs/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="https://github.com/shengzhou1216/docs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GoLang相关" class="dropdown-title"><span class="title">GoLang相关</span> <span class="arrow down"></span></button> <button type="button" aria-label="GoLang相关" class="mobile-dropdown-title"><span class="title">GoLang相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/golang/basic/" class="nav-link">
  GoLang基础
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java相关" class="dropdown-title"><span class="title">Java相关</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java相关" class="mobile-dropdown-title"><span class="title">Java相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/java/basic/" class="nav-link">
  Java基础
</a></li><li class="dropdown-item"><!----> <a href="/docs/java/jvm/" class="nav-link">
  JVM
</a></li><li class="dropdown-item"><!----> <a href="/docs/java/spring/" class="nav-link">
  Spring相关
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaScript相关" class="dropdown-title"><span class="title">JavaScript相关</span> <span class="arrow down"></span></button> <button type="button" aria-label="JavaScript相关" class="mobile-dropdown-title"><span class="title">JavaScript相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/js/入门/" class="nav-link">
  入门
</a></li><li class="dropdown-item"><!----> <a href="/docs/js/es6/" class="nav-link">
  es6
</a></li><li class="dropdown-item"><!----> <a href="/docs/js/typescript/" class="nav-link">
  typescript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端开发" class="dropdown-title"><span class="title">前端开发</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端开发" class="mobile-dropdown-title"><span class="title">前端开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/frontend/basic/" class="nav-link">
  前端基础
</a></li><li class="dropdown-item"><!----> <a href="/docs/frontend/browser/" class="nav-link">
  浏览器
</a></li><li class="dropdown-item"><!----> <a href="/docs/frontend/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/docs/frontend/react/" class="nav-link">
  React
</a></li></ul></div></div><div class="nav-item"><a href="/docs/docker/" class="nav-link router-link-active">
  Docker
</a></div><div class="nav-item"><a href="/docs/linux/" class="nav-link">
  Linux
</a></div><div class="nav-item"><a href="/docs/blockchain/" class="nav-link">
  Blockchain
</a></div><div class="nav-item"><a href="/docs/cryptograph/" class="nav-link">
  密码学
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CS" class="dropdown-title"><span class="title">CS</span> <span class="arrow down"></span></button> <button type="button" aria-label="CS" class="mobile-dropdown-title"><span class="title">CS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/cs/computer-architecture/" class="nav-link">
  计算机组成原理
</a></li><li class="dropdown-item"><!----> <a href="/docs/cs/operating-system/" class="nav-link">
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/docs/cs/computer-network/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/docs/docker/practice/.html" class="nav-link">
  算法
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发工具" class="dropdown-title"><span class="title">开发工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发工具" class="mobile-dropdown-title"><span class="title">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/vscode/" class="nav-link">
  VSCode
</a></li></ul></div></div><div class="nav-item"><a href="/docs/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="https://github.com/shengzhou1216/docs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>使用Docker部署mysql</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/docker/practice/%E9%83%A8%E7%BD%B2mysql.html#启动服务" class="sidebar-link">启动服务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/docker/practice/%E9%83%A8%E7%BD%B2mysql.html#docker-run" class="sidebar-link">docker run</a></li><li class="sidebar-sub-header"><a href="/docs/docker/practice/%E9%83%A8%E7%BD%B2mysql.html#连接mysql" class="sidebar-link">连接mysql</a></li><li class="sidebar-sub-header"><a href="/docs/docker/practice/%E9%83%A8%E7%BD%B2mysql.html#docker-compose-yml" class="sidebar-link">docker-compose.yml</a></li></ul></li><li><a href="/docs/docker/practice/%E9%83%A8%E7%BD%B2mysql.html#使用自定义的配置文件" class="sidebar-link">使用自定义的配置文件</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/docker/practice/%E9%83%A8%E7%BD%B2mysql.html#不使用cnf文件进行配置" class="sidebar-link">不使用cnf文件进行配置</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/docker/practice/%E9%83%A8%E7%BD%B2mysql.html#docker秘钥" class="sidebar-link">Docker秘钥</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/docker/practice/%E9%83%A8%E7%BD%B2mysql.html#defining-and-using-secrets-in-compose-files" class="sidebar-link">Defining and using secrets in compose files</a></li></ul></li><li><a href="/docs/docker/practice/%E9%83%A8%E7%BD%B2mysql.html#初始化实例" class="sidebar-link">初始化实例</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/docker/practice/%E9%83%A8%E7%BD%B2mysql.html#注意事项" class="sidebar-link">注意事项</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/docker/practice/%E9%83%A8%E7%BD%B2mysql.html#存储数据" class="sidebar-link">存储数据</a></li><li class="sidebar-sub-header"><a href="/docs/docker/practice/%E9%83%A8%E7%BD%B2mysql.html#针对已经存在的数据库" class="sidebar-link">针对已经存在的数据库</a></li><li class="sidebar-sub-header"><a href="/docs/docker/practice/%E9%83%A8%E7%BD%B2mysql.html#以任意用户身份运行" class="sidebar-link">以任意用户身份运行</a></li><li class="sidebar-sub-header"><a href="/docs/docker/practice/%E9%83%A8%E7%BD%B2mysql.html#创建数据库备份" class="sidebar-link">创建数据库备份</a></li><li class="sidebar-sub-header"><a href="/docs/docker/practice/%E9%83%A8%E7%BD%B2mysql.html#从数据库备份中恢复数据" class="sidebar-link">从数据库备份中恢复数据</a></li></ul></li><li><a href="/docs/docker/practice/%E9%83%A8%E7%BD%B2mysql.html#参考" class="sidebar-link">参考</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/docker/practice/%E9%83%A8%E7%BD%B2mysql.html#错误" class="sidebar-link">错误</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/docker/practice/%E9%83%A8%E7%BD%B2mysql.html#failed-to-access-directory-for-secure-file-priv-please-make-sure-that-directory-exists-and-is-accessible-by-mysql-server-supplied-value-var-lib-mysql-files" class="sidebar-link">Failed to access directory for --secure-file-priv. Please make sure that directory exists and is accessible by MySQL Server. Supplied value : /var/lib/mysql-files</a></li><li class="sidebar-sub-header"><a href="/docs/docker/practice/%E9%83%A8%E7%BD%B2mysql.html#启动容器后-无法登录mysql" class="sidebar-link">启动容器后，无法登录mysql</a></li><li class="sidebar-sub-header"><a href="/docs/docker/practice/%E9%83%A8%E7%BD%B2mysql.html#docker-compose-down-或-docker-compose-stop后-再此启动-则无法访问-message-from-server-host-192-168-224-4-is-not-allowed-to-connect-to-this-mysql-server" class="sidebar-link">docker-compose down 或 docker-compose stop后，再此启动，则无法访问“message from server: &quot;Host '192.168.224.4' is not allowed to connect to this MySQL server&quot;“</a></li><li class="sidebar-sub-header"><a href="/docs/docker/practice/%E9%83%A8%E7%BD%B2mysql.html#如何在启动mysql时-自动导入数据库" class="sidebar-link">如何在启动mysql时，自动导入数据库</a></li><li class="sidebar-sub-header"><a href="/docs/docker/practice/%E9%83%A8%E7%BD%B2mysql.html#存在远程访问权限的问题" class="sidebar-link">存在远程访问权限的问题:</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="使用docker部署mysql"><a href="#使用docker部署mysql" class="header-anchor">#</a> 使用Docker部署mysql</h1> <p></p><div class="table-of-contents"><ul><li><a href="#启动服务">启动服务</a><ul><li><a href="#docker-run">docker run</a></li><li><a href="#连接mysql">连接mysql</a></li><li><a href="#docker-compose-yml">docker-compose.yml</a><ul><li><a href="#环境变量说明">环境变量说明</a></li></ul></li></ul></li><li><a href="#使用自定义的配置文件">使用自定义的配置文件</a></li><li><a href="#不使用-cnf-文件进行配置">不使用cnf文件进行配置</a></li><li><a href="#docker秘钥">Docker秘钥</a><ul><li><a href="#defining-and-using-secrets-in-compose-files-https-docs-docker-com-engine-swarm-secrets-defining-and-using-secrets-in-compose-files">Defining and using secrets in compose files</a><ul><li><a href="#使用">使用</a></li></ul></li></ul></li><li><a href="#初始化实例">初始化实例</a></li><li><a href="#注意事项">注意事项</a><ul><li><a href="#存储数据">存储数据</a></li><li><a href="#针对已经存在的数据库">针对已经存在的数据库</a></li><li><a href="#以任意用户身份运行">以任意用户身份运行</a></li><li><a href="#创建数据库备份">创建数据库备份</a></li><li><a href="#从数据库备份中恢复数据">从数据库备份中恢复数据</a></li></ul></li><li><a href="#参考">参考</a></li><li><a href="#错误">错误</a><ul><li><a href="#failed-to-access-directory-for-secure-file-priv-please-make-sure-that-directory-exists-and-is-accessible-by-mysql-server-supplied-value-var-lib-mysql-files">Failed to access directory for --secure-file-priv. Please make sure that directory exists and is accessible by MySQL Server. Supplied value : /var/lib/mysql-files</a></li><li><a href="#启动容器后-无法登录mysql">启动容器后，无法登录mysql</a><ul><li><a href="#问题出现原因">问题出现原因</a></li><li><a href="#解决方法">解决方法</a></li></ul></li><li><a href="#docker-compose-down-或-docker-compose-stop后-再此启动-则无法访问-message-from-server-host-192-168-224-4-is-not-allowed-to-connect-to-this-mysql-server">docker-compose down 或 docker-compose stop后，再此启动，则无法访问“message from server: &quot;Host '192.168.224.4' is not allowed to connect to this MySQL server&quot;“</a></li><li><a href="#如何在启动mysql时-自动导入数据库">如何在启动mysql时，自动导入数据库</a><ul><li><a href="#initializing-a-fresh-instance">Initializing a fresh instance</a></li></ul></li><li><a href="#存在远程访问权限的问题">存在远程访问权限的问题:</a></li></ul></li></ul></div><p></p> <h2 id="启动服务"><a href="#启动服务" class="header-anchor">#</a> 启动服务</h2> <h3 id="docker-run"><a href="#docker-run" class="header-anchor">#</a> docker run</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker run --name some-mysql -e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>my-secret-pw -d mysql:tag
</code></pre></div><ul><li>my-secret-pw 是 root 用户的密码</li></ul> <h3 id="连接mysql"><a href="#连接mysql" class="header-anchor">#</a> 连接mysql</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>docker run -it --network some-network --rm mysql mysql -h some-mysql -uexample-user -p
</code></pre></div><ul><li>some-mysql 是你刚刚启动的容器的名称</li> <li>some-network 是 Docker network</li></ul> <p>此命令也可以连接非Docker启动的mysql</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker run -it --rm mysql mysql -h some.mysql.host -usome-mysql-user -p
</code></pre></div><h3 id="docker-compose-yml"><a href="#docker-compose-yml" class="header-anchor">#</a> docker-compose.yml</h3> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3.9&quot;</span>
 <span class="token key atrule">mysql</span><span class="token punctuation">:</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> style<span class="token punctuation">-</span>ma<span class="token punctuation">-</span>db
    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>default<span class="token punctuation">-</span>authentication<span class="token punctuation">-</span>plugin=mysql_native_password
    <span class="token key atrule">image</span><span class="token punctuation">:</span> style<span class="token punctuation">-</span>ma<span class="token punctuation">-</span>db
    <span class="token key atrule">build</span><span class="token punctuation">:</span>
      <span class="token key atrule">context</span><span class="token punctuation">:</span> db
      <span class="token key atrule">dockerfile</span><span class="token punctuation">:</span> Dockerfile
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 3306<span class="token punctuation">:</span><span class="token number">3306</span>
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span> root
      <span class="token key atrule">MYSQL_ROOT_HOST</span><span class="token punctuation">:</span> <span class="token string">'%'</span>
      <span class="token key atrule">MYSQL_DATABASE</span><span class="token punctuation">:</span> style_app
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ~/style<span class="token punctuation">-</span>ma/dev/mysql<span class="token punctuation">:</span>/var/lib/mysql
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> style<span class="token punctuation">-</span>ma

  <span class="token key atrule">adminer</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> adminer
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> style<span class="token punctuation">-</span>ma<span class="token punctuation">-</span>db<span class="token punctuation">-</span>adminer
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 9999<span class="token punctuation">:</span><span class="token number">8080</span>
      
<span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token key atrule">style-ma</span><span class="token punctuation">:</span>
    <span class="token key atrule">driver</span><span class="token punctuation">:</span> bridge
   
</code></pre></div><h4 id="环境变量说明"><a href="#环境变量说明" class="header-anchor">#</a> 环境变量说明</h4> <ul><li><p><code>MYSQL_ROOT_PASSWORD</code>: 此环境变量是强制的，指定的密码会被设置为 <code>root</code> 超级账户的密码。</p></li> <li><p><code>MYSQL_DATABASE</code>(可选): 指定在镜像启动后要创建的数据库名称。如果同时指定了用户名和密码，这个用户会被授予此数据库的超级用户权限（对应于<code>GRANT ALL</code>）</p></li> <li><p><code>MYSQL_USER</code>(可选),<code>MYSQL_PASSWORD</code>(可选): 创建一个新的用户并设置该用户的密码。此用户会被赋予<code>MYSQL_DATABASE</code>所指定的数据库的超级用户权限。要创建一个用户，这两个环境变量都需要设置</p></li> <li><p><code>MYSQL_ALLOW_EMPTY_PASSWORD</code>(可选): 设置非空值，如 <code>yes</code>，允许root用户不用密码启动容器。注意: 不建议设置此环境变量为<code>yes</code>，除非你直到你在做什么，因为此操作会让你的数据库完全不受保护，任何人都可以获取超级用户访问权限。</p></li> <li><p><code>MYSQL_RANDOM_ROOT_PASSWORD</code>(可选): 设置非空值，如<code>yes</code>，为root用户生成一个随机的初始密码(使用<code>pwgen</code>)。生成的密码会在stdout中打印(<code>GENERATED ROOT PASSWORD: .....</code>)</p></li> <li><p><code>MYSQL_ONETIME_PASSWORD</code>(可选): 设置root用户(不是在<code>MYSQL_USER</code>中指定的用户)在初始完成后即过期，在第一次登录时强制修改密码。任意非空值都会激活此配置。注意: 此功能只支持MySQL 5.6+版本。在MySQL 5.5上使用此功能会在初始化时报错。</p></li> <li><p><code>MYSQL_INITDB_SKIP_TZINFO</code>: 默认情况下，entrypoint脚本自动加载 <code>CONVERT_TZ()</code>函数所需要的时区数据。如果不需要，任意非空值会禁用时区加载。</p></li></ul> <p>./db/Dockerfile:</p> <div class="language-dockerfile extra-class"><pre class="language-dockerfile"><code><span class="token keyword">FROM</span> mysql<span class="token punctuation">:</span>8.0
<span class="token keyword">COPY</span> style_app.sql /docker<span class="token punctuation">-</span>entrypoint<span class="token punctuation">-</span>initdb.d
<span class="token keyword">EXPOSE</span> 3306
</code></pre></div><h2 id="使用自定义的配置文件"><a href="#使用自定义的配置文件" class="header-anchor">#</a> 使用自定义的配置文件</h2> <p>例如，自定义配置文件位置为<code>/my/custom/config-file.cnf</code>，挂载配置文件 <code>/my/custom:/etc/mysql/conf.d</code></p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker run --name some-mysql -v /my/custom:/etc/mysql/conf.d -e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>my-secret-pw -d mysql:tag
</code></pre></div><p>mysql运行时会使用 <code>/etc/mysql/my.cnf</code>  和 <code>/etc/mysql/conf.d/config-file.cnf</code> 中的配置（后面的优先级高)</p> <h2 id="不使用cnf文件进行配置"><a href="#不使用cnf文件进行配置" class="header-anchor">#</a> 不使用<code>cnf</code>文件进行配置</h2> <p>大多配置可以作为参数传递给 <code>mysqld</code>。 如:  设置mysql server 的字符集:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker run --name some-mysql -e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>my-secret-pw -d mysql:tag --character-set-server<span class="token operator">=</span>utf8mb4 --collation-server<span class="token operator">=</span>utf8mb4_unicode_ci
</code></pre></div><p>如果要查看所有可用的配置项，可以运行:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker run -it --rm mysql:tag --verbose --help
</code></pre></div><h2 id="docker秘钥"><a href="#docker秘钥" class="header-anchor">#</a> Docker秘钥</h2> <p>除了使用环境变量传递敏感信息外，还可以在上面列出的环境变量后面追加<code>_FILE</code>，让初始化脚本从容器的文件中加载这些变量。特别的，这中方式可以用于从存储在 <code>/run/secrets/&lt;secret_name&gt;</code> 文件中的Docker秘钥加载密码。例如:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>docker run --name some-mysql -e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD_FILE</span><span class="token operator">=</span>/run/secrets/mysql-root -d mysql:tag
</code></pre></div><p>当前这种方式只支持: <code>MYSQL_ROOT_PASSWORD</code>, <code>MYSQL_ROOT_HOST</code>, <code>MYSQL_DATABASE</code>, <code>MYSQL_USER</code>, and <code>MYSQL_PASSWORD</code>.</p> <blockquote><p>Docker secrets 是什么?</p> <p>https://docs.docker.com/engine/reference/commandline/secret/</p> <p>https://docs.docker.com/engine/swarm/secrets/</p> <h3 id="defining-and-using-secrets-in-compose-files"><a href="#defining-and-using-secrets-in-compose-files" class="header-anchor">#</a> <a href="https://docs.docker.com/engine/swarm/secrets/#defining-and-using-secrets-in-compose-files" target="_blank" rel="noopener noreferrer">Defining and using secrets in compose files<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3></blockquote> <h4 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h4> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">services</span><span class="token punctuation">:</span>
	<span class="token key atrule">mysql</span><span class="token punctuation">:</span>
		<span class="token punctuation">...</span>.
        <span class="token key atrule">secrets</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> mysql_root
        <span class="token key atrule">environment</span><span class="token punctuation">:</span>
          <span class="token key atrule">MYSQL_ROOT_PASSWORD_FILE</span><span class="token punctuation">:</span> /run/secrets/mysql_root
<span class="token key atrule">secrets</span><span class="token punctuation">:</span>
  <span class="token key atrule">mysql_root</span><span class="token punctuation">:</span>
    <span class="token key atrule">file</span><span class="token punctuation">:</span> ~/todolist/dev/mysql/conf/mysql_root
</code></pre></div><h2 id="初始化实例"><a href="#初始化实例" class="header-anchor">#</a> 初始化实例</h2> <p>容器首次启动后，会根据提供的数据库名创建一个新的数据库。此外，它会执行``/docker-entrypoint-initdb.d<code>中的</code>.sh<code>，</code>.sql<code>和</code>.sql.gz`文件。 这些文件会按照字母顺序执行。</p> <h2 id="注意事项"><a href="#注意事项" class="header-anchor">#</a> 注意事项</h2> <h3 id="存储数据"><a href="#存储数据" class="header-anchor">#</a> 存储数据</h3> <ol><li><p>创建数据存储目录 <code>/my/own/datadir</code></p></li> <li><p>挂载目录到 <code>/var/lib/mysql</code></p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker run --name some-mysql -v /my/own/datadir:/var/lib/mysql -e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>my-secret-pw -d mysql:tag
</code></pre></div></li></ol> <h3 id="针对已经存在的数据库"><a href="#针对已经存在的数据库" class="header-anchor">#</a> 针对已经存在的数据库</h3> <p>如果关在的数据目录中已经有一个数据库了，那么 <code>MYSQL_ROOT_PASSWORD</code>变量会被忽略，已存在的数据库不会有任何改变。</p> <h3 id="以任意用户身份运行"><a href="#以任意用户身份运行" class="header-anchor">#</a> 以任意用户身份运行</h3> <p>使用 --user 设置以哪个用户运行（除了<code>root/0</code>）。例如:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">mkdir</span> data
$ <span class="token function">ls</span> -lnd data
drwxr-xr-x <span class="token number">2</span> <span class="token number">1000</span> <span class="token number">1000</span> <span class="token number">4096</span> Aug <span class="token number">27</span> <span class="token number">15</span>:54 data
$ docker run -v <span class="token string">&quot;<span class="token environment constant">$PWD</span>/data&quot;</span>:/var/lib/mysql --user <span class="token number">1000</span>:1000 --name some-mysql -e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>my-secret-pw -d mysql:tag
</code></pre></div><h3 id="创建数据库备份"><a href="#创建数据库备份" class="header-anchor">#</a> 创建数据库备份</h3> <p>使用 <code>docker exec</code>来运行工具。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker <span class="token builtin class-name">exec</span> some-mysql <span class="token function">sh</span> -c <span class="token string">'exec mysqldump --all-databases -u root -p&quot;<span class="token variable">$MYSQL_ROOT_PASSWORD</span>&quot;'</span> <span class="token operator">&gt;</span> /some/path/on/your/host/all-databases.sql
</code></pre></div><h3 id="从数据库备份中恢复数据"><a href="#从数据库备份中恢复数据" class="header-anchor">#</a> 从数据库备份中恢复数据</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker <span class="token builtin class-name">exec</span> -i some-mysql <span class="token function">sh</span> -c <span class="token string">'exec mysql -u root -p&quot;<span class="token variable">$MYSQL_ROOT_PASSWORD</span>&quot;'</span> <span class="token operator">&lt;</span> /some/path/on/your/host/all-databases.sql
</code></pre></div><p>上面的命令无效，会报Access Denied错误。可以使用下面的命令:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker <span class="token builtin class-name">exec</span> -i todolist-mysql-test mysql -u root --password<span class="token operator">=</span><span class="token operator">&lt;</span>password<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>database<span class="token operator">&gt;</span> <span class="token operator">&lt;</span> ~/xxxx.sql
</code></pre></div><h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <p>翻译自: https://hub.docker.com/_/mysql</p> <h2 id="错误"><a href="#错误" class="header-anchor">#</a> 错误</h2> <h3 id="failed-to-access-directory-for-secure-file-priv-please-make-sure-that-directory-exists-and-is-accessible-by-mysql-server-supplied-value-var-lib-mysql-files"><a href="#failed-to-access-directory-for-secure-file-priv-please-make-sure-that-directory-exists-and-is-accessible-by-mysql-server-supplied-value-var-lib-mysql-files" class="header-anchor">#</a> Failed to access directory for --secure-file-priv. Please make sure that directory exists and is accessible by MySQL Server. Supplied value : /var/lib/mysql-files</h3> <div class="language- extra-class"><pre class="language-text"><code>style-ma-db | 2021-01-11 06:47:41+00:00 [Note] [Entrypoint]: Switching to dedicated user 'mysql'
style-ma-db | 2021-01-11 06:47:41+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.22-1debian10 started.
style-ma-db | mysqld: Error on realpath() on '/var/lib/mysql-files' (Error 2 - No such file or directory)
style-ma-db | 2021-01-11T06:47:42.156884Z 0 [ERROR] [MY-010095] [Server] Failed to access directory for --secure-file-priv. Please make sure that directory exists and is accessible by MySQL Server. Supplied value : /var/lib/mysql-files
style-ma-db | 2021-01-11T06:47:42.156895Z 0 [ERROR] [MY-010119] [Server] Aborting
</code></pre></div><p>配置文件挂载错了</p> <div class="language- extra-class"><pre class="language-text"><code>- /opt/mysql/my.conf:/etc/mysql/my.conf
</code></pre></div><p>应改为:</p> <div class="language- extra-class"><pre class="language-text"><code>- /opt/mysql/my.cnf:/etc/mysql/my.cnf
</code></pre></div><h3 id="启动容器后-无法登录mysql"><a href="#启动容器后-无法登录mysql" class="header-anchor">#</a> 启动容器后，无法登录mysql</h3> <p>docker-compose配置如下:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">mysql</span><span class="token punctuation">:</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> style<span class="token punctuation">-</span>ma<span class="token punctuation">-</span>db
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql
    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>default<span class="token punctuation">-</span>authentication<span class="token punctuation">-</span>plugin=mysql_native_password
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 3306<span class="token punctuation">:</span><span class="token number">3306</span>
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span> root
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /opt/mysql/data<span class="token punctuation">:</span>/var/lib/mysql
      <span class="token punctuation">-</span> /opt/mysql/logs<span class="token punctuation">:</span>/var/log/mysql
      <span class="token punctuation">-</span> /opt/mysql/my.cnf<span class="token punctuation">:</span>/etc/mysql/my.cnf
      <span class="token punctuation">-</span> /opt/mysql/conf<span class="token punctuation">:</span>/etc/mysql
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> backend
</code></pre></div><p>这里设置了<code>MYSQL_ROOT_PASSWORD</code>，然而 <code>mysql -u root -p</code>使用root却无法登录。</p> <h4 id="问题出现原因"><a href="#问题出现原因" class="header-anchor">#</a> 问题出现原因</h4> <p>The image <code>entrypoint</code> script will never make changes to a <code>database</code> which is existing. If you mount an existing data directory into <code>var/lib/mysql</code> then <code>MYSQL_ROOT_PASSWORD</code> will have no effect.</p> <h4 id="解决方法"><a href="#解决方法" class="header-anchor">#</a> 解决方法</h4> <p>第一步：找出容器volume名称</p> <p>你手动设置了volume名称，可以用<code>docker volume ls</code>查看；</p> <p>如果没有手动设置，那么可以使用<code>docker insepect &lt;mysql_container&gt;</code>命令 查看</p> <p>第二步：删除该volume</p> <p><code>docker volume rm &lt;volume_name&gt;</code></p> <p>已经删除了volume，再次启动容器，进入容器后，输入<code>mysql -u root -p</code></p> <p>输入密码，还是无法访问</p> <div class="language- extra-class"><pre class="language-text"><code> Access denied for user 'root'@'localhost' (using password: YES)
</code></pre></div><p>参考了这个回答，与上面的思路一致，没有什么帮助。https://stackoverflow.com/questions/59838692/mysql-root-password-is-set-but-getting-access-denied-for-user-rootlocalhost</p> <p>到目前已经确认不是volumes缓存的问题。</p> <p>最终找到问题处在默认要执行的sql上，默认要执行的sql中创建了多余的系统数据库和表，可能是这些多余的数据库和表造成的问题。在sql中删除这些默认的数据库和表后，问题解决。</p> <h3 id="docker-compose-down-或-docker-compose-stop后-再此启动-则无法访问-message-from-server-host-192-168-224-4-is-not-allowed-to-connect-to-this-mysql-server"><a href="#docker-compose-down-或-docker-compose-stop后-再此启动-则无法访问-message-from-server-host-192-168-224-4-is-not-allowed-to-connect-to-this-mysql-server" class="header-anchor">#</a> docker-compose down 或 docker-compose stop后，再此启动，则无法访问“message from server: &quot;Host '192.168.224.4' is not allowed to connect to this MySQL server&quot;“</h3> <p>docker-compose down 会移除容器，但是不会移除volumes。</p> <p>docker-compose stop 不会移除容器，也不会移除volumes。</p> <h3 id="如何在启动mysql时-自动导入数据库"><a href="#如何在启动mysql时-自动导入数据库" class="header-anchor">#</a> 如何在启动mysql时，自动导入数据库</h3> <h4 id="initializing-a-fresh-instance"><a href="#initializing-a-fresh-instance" class="header-anchor">#</a> Initializing a fresh instance</h4> <p>When a container is started for the first time, a new database with the specified name will be created and initialized with the provided configuration variables. Furthermore, it will execute files with extensions <code>.sh</code>, <code>.sql</code> and <code>.sql.gz</code> that are found in <code>/docker-entrypoint-initdb.d</code>. Files will be executed in alphabetical order. You can easily populate your <code>mysql</code> services by <a href="https://docs.docker.com/engine/tutorials/dockervolumes/#mount-a-host-file-as-a-data-volume" target="_blank" rel="noopener noreferrer">mounting a SQL dump into that directory<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and provide <a href="https://docs.docker.com/reference/builder/" target="_blank" rel="noopener noreferrer">custom images<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> with contributed data. SQL files will be imported by default to the database specified by the <code>MYSQL_DATABASE</code> variable.</p> <p>将sql文件挂载到容器的<code>/docker-entrypoint-initdb.d</code>目录下，然后设置环境变量<code>MYSQL_DATABASE</code>的值。</p> <h3 id="存在远程访问权限的问题"><a href="#存在远程访问权限的问题" class="header-anchor">#</a> 存在远程访问权限的问题:</h3> <p>mysql 默认只能本机登录，使用 <code>MYSQL_ROOT_HOST</code>环境变量 ，将其值修改为 <code>MYSQL_ROOT_HOST: '%'</code></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后一次更新于:</span> <span class="time">7/2/2021, 12:43:32 PM</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/docs/assets/js/app.01c93764.js" defer></script><script src="/docs/assets/js/2.2d8514e9.js" defer></script><script src="/docs/assets/js/27.4170579d.js" defer></script>
  </body>
</html>
