# 4 类、对象和方法介绍

[[toc]]

类是Java的精髓。整个Java语言是在类的基础上构建的，因为类定义了一个对象的本质。因此，类构成了Java中面向对象编程的基础。在一个类中，有定义的数据和对数据进行的操作（方法）。

## 类基础

类是定义对象的一个模板。它定义了数据和对数据的相关操作。Java使用类来构造对象。对象是类的实例。关键要明确一点: 类是抽象的。先有类，再有对象。

另一点要明确的是: 组成一个类的方法和变量叫做一个类的*成员*。这些数据成员也被称为 *实例变量*.

### 类的一般形式

```
class classname {
    // declare instance variables
    type var1;
    type var2;
    // ...
    type varN;

    // declare methods
    type method1(parameters) {
     // body of method
    }
    type method2(parameters) {
     // body of method
    }
    // ...
    type methodN(parameters) {
     // body of method
    }
}
```

> 注: 一般情况下，对于一个逻辑实体定义一个类，且只定义一个类。

### 定义一个类

```java
class Vehicle {
    int passengers; // number of passengers
    int fuelcap; // fuel capacity in gallons
    int mpg; // fuel consumption in miles per gallon
}
```

定义一个类，就创建了一个新的类型。在上面的例子中，我们创建了一个新的类型——Vehicle.  

创建Vehicle对象:

```java
Vehicle minivan = new Vehicle();
```

访问成员:

```java
minivam.fuelcap = 16;
```

### 对象是如何创建的

```java
Vehicle minivan = new Vehicle();
```

上面的语句执行了两个函数。首先，声明了一个类型为 Vehicle 的变量 minivan。这个变量没有定义对象。相反，它只是一个能够的指向该对象的变量。其次，声明语句创建了一个对象的实例，并且将对象的引用赋给了 minivan。这是通过new 运算符完成的。

new 运算符动态的为对象分配内存，并返回该对象的引用。这个引用，就是对象在内存中的地址。然后，这个引用存储在一个变量中。因此，在Java中，所有类的对象必须动态分配。

将这两拆分开，就是:

```java
Vehicle minivam; // 定义对象的引用
minivan = new Vehicle(); // 分配一个Vehicle对象
```

### 引用变量和赋值

在复制操作中，对象的引用变量的行为与原始类型变量的行为不同。

对于原始类型变量，赋值操作是值传递。

对于引用类型的变量，赋值操作是引用传递。

## 方法

上面提到，实例变量和方法构成了类。方法一般定义了对于数据的操作，一般形式如下:

```
ret-type name( parameter-list ) {
    // body of method
}
```

### 从方法中返回

通常，有两种情况会导致方法返回。一种是, 方法执行完了； 一种是，执行了 return 语句。

```java
return value;
// or
return; // return void
```

### 构造函数

构造函数用于在对象创建时对其进行初始化。它有以下特点/规定:

- 名称和类名相同
- 没有返回类型

所有类都有构造函数，无论你是否定义了构造函数，因为Java会自动提供一个默认的无参构造函数。在这种情况下，非初始化的成员变量都有一个默认值，它们是 0 ， null 和 false ， 分配对应 数值型，引用类型 和 布尔类型变量。要是你定义了自己的构造函数，那么就不会生成默认的无参构造函数了。

##  重新审视new

```
class-var = new class-name(arg-list);
```

class-var 是一个要创建的类型的变量，class-name是要初始化的类。如果类没有定义自己的构造函数，那么new会使用Java提供的默认的无参构造。因此，new 可以用来创建任意类型的对象。new 返回新创建的对象的引用，该引用被赋值给 class-var。

由于内存是有限的，可能由于内存不足，new无法为对象分配内存。如果出现这种情况，就会出现运行时错误。

## 垃圾收集

如上所述，通过new动态的从可用内存池中为对象分配内存。内存是有限的，可用内存可能会被耗尽。因此，new 操作可能会由于内存不足而失败。因此，一个动态分配方案的关键就是：从未使用的对象恢复可用内存，使得该内存可用于后续的重新分配。在一些编程语言中，以前分配的内存的释放是手动处理的。然而，Java使用了一种不同的、更省事的方法：垃圾收集。

Java的垃圾收集系统自动回收对象--在幕后透明地发生，不需要任何程序员干预。其工作流程是：当一个对象没有被任何一个变量引用时，该对象就被认为不再需要了，该对象所占用的内存被释放。这个回收的内存可以用于后续的分配。

垃圾收集只在你的程序执行过程中零星地发生。它不会仅仅因为存在一个或多个不再使用的对象而发生。为了提高效率，垃圾收集器通常只在满足两个条件时运行：有对象要回收，有理由要回收。记住，垃圾回收需要时间，所以Java运行时系统只在适当的时候才进行垃圾回收。因此，你不可能精确地知道什么时候会进行垃圾回收

## this

当一个方法被调用时，会隐式地传递一个对象（即方法被调用的对象）的引用给它。这个引用叫做 this. 